<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>无标题页</title>
<script src="http://chhblog.com/upload/1/files/myfiles/jquery-1_8_1_min.js" type="text/javascript"></script>
<style>
body, div, img{ margin:0; padding: 0;}
body{ overflow: hidden; background: #666;}
#loading{ font-size: 30px; position: absolute; width: 200px; text-align: center; left:50%; top: 50%; margin-left: -100px; color: white;} 
.default{ position: absolute; left: 0px; top: 0px; display: none;}
.default img{ width: 100%; height: 100%;}
.items{ position: absolute; left: 0; width: 100%; display: none; overflow: hidden; z-index: 1;}
.item{ width: 100%;}
.item img{ width: 100%; height: 170px;}
.img_outer{ width: 100%; position: relative;}
.img_outer .desc{ position: absolute; bottom:0; left: 50px; background: #fff; width: 300px; height: 300px;}
.img_outer .img{ width: 100%; height: 100%;}
.nav{ width: 100px; height: 200px; border:1px solid #000; position: absolute; background: #fff; z-index: 999;}
.nav ul li{ cursor: pointer;}
</style>
</head>
<body>

<div id="loading">玩命加载中...</div>

<script typ="text/javascript">
function SpeedChange( count ) {
    var interVal = 30;
    var self = this;

    this.onChange = function( all, current ) {}

    this.onEnd = function() {}

    this.start = function() {
        var distance = 0;
        var timer = window.setInterval( function() {
            var speed = ( count - distance ) / 5;
            speed = speed > 0 ? Math.ceil( speed ) : Math.floor( speed );    
            distance += speed;
            if( typeof( self.onChange ) == 'function' ) {
                self.onChange( distance, speed );
            }

            if( distance >= count ) {
                window.clearInterval( timer );
                if( typeof( self.onEnd ) == 'function' ) {
                    self.onEnd();
                }
            }
        }, interVal );
    }
}


var data = [ 
	{  thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/14.jpg', images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/14.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
	] },
	{  thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/15.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/19.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/20.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/21.jpg'
	]},
	{ thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/16.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/23.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/24.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/25.jpg'
	]},
	{ thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/17.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
	]},
	{ thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/18.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/18.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
	]},
	{ thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/19.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/19.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
	]},
	{ thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/20.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/20.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
	]},
	{ thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/21.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/21.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
	]},
	{ thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/22.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/22.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
	]},
	{ thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/23.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/23.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
	]},
	{ thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/24.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/24.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
	]},
	{ thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/25.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/25.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
	]},
	{ thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/26.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/26.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
	]},
	{ thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/27.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/27.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
	]},
	{ thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/28.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/28.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
	]},
	{ thumb: 'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/29.jpg' , images: [
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/29.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg',
				'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
	]}
];

function loadResource( images, loaded ) {
	var count = images.length;
	var currCount = 0;
	var timer;
	for( var i = 0; i < images.length; i++ ) {
		var elementHtml = '<img src="'+ images[ i ] +'" style="display:none;" class="preload" />';
		var element = $( elementHtml );
		element.bind( 'load', function() {
			currCount ++;
			if( currCount == count ) {
				if( typeof( loaded ) == 'function' ) {
					loaded();
				}
				window.clearTimeout( timer );
				$( '.preload' ).remove();
			}
		} );
		$( 'body' ).append( element );
		timer = window.setTimeout( function() {
			if( typeof( loaded ) == 'function' ) {
				loaded();
			}
			$( '.preload' ).remove();
		}, 60000 );
	}
}

function genItems() {
	var html = "";
	for( var i = 0; i < data.length; i++ ) {
		var item = data[ i ];
		html += "<div class='item'><img src='"+ item.thumb +"' /></div>"; 
	}
	html = '<div class="items" id="items">' + html + '</div>';
	$( 'body' ).append( $( html ) );
}

function init() {
	genItems();
	var defaultHtml = '<div class="default" id="default">' +
							'<img src="http://chhblog.com/upload/1/files/myfiles/20131015/images/14.jpg" />'+
					  '</div>';
	$( 'body' ).append( $( defaultHtml ) );	
	$( '#default' ).show().width( $( window ).width() ).height( $( window ).height() )
	.bind( 'click', function() {
		hideDefaultImageAndShowItems();
	} );
}

function hideDefaultImageAndShowItems() {
	$( '#items' ).show()
		.css( 'top', $( window ).height() )
		.css( 'height', $( window ).height() );

	var sc = new SpeedChange( $( window ).height() );

	sc.onChange = function( all, current ) {
	    var top = parseFloat( $( '#default' ).css( 'top' ) );
	    var itemTop = parseFloat( $( '#items' ).css( 'top' ) );
	   $( '#default' ).css( 'top', top - current ); 
	   $( '#items' ).css( 'top', itemTop - current );
	}

	sc.onEnd = function() {   
		bindScrollItemsEvent();
		renderNav();
	}

	sc.start();
}

function renderNav() {
	var html = '<div class="nav" id="nav">' +
					'<ul>' +
						'<li index="0">主题1</li>'+
						'<li index="1">主题2</li>'+
						'<li index="2">主题3</li>'+
						'<li index="3">主题4</li>'+
						'<li index="5">主题5</li>'+
					'</ul>'+
				'</div>';
	$( 'body' ).append( $( html ) );
	if( navigator.userAgent.indexOf( 'MSIE' ) != -1 ) {
	 	window.setInterval( function() {
			$( '#nav' ).css( {
				right: 0,
				top: $( document ).scrollTop() + $( window ).height() / 2
			} );
		}, 30 );
	 } else {
	 	$( '#nav' ).css( {
	 		position: 'fixed',
	 		right: 0,
	 		top: '50%'
	 	} );
	 }

	 $( '#nav ul li' ).bind( 'click', function() {
	 	$( document ).scrollTop( 0 );
	 	$( '#items' ).hide();
	 	renderSubject( data[ $( this ).attr( 'index' ) ] );
	 } );
}

function descScroll() {
	$( '.img_outer .desc' ).each( function( index, element ) {
		var scrollTop = $( document ).scrollTop();
		var self = $( this );
		var selfHeight = self.height();
		var outer = self.parent();
		var prev = outer.prev();
		var prevHeightAndTop = prev.offset().top + prev.height();
		var selfOffsetTop = prevHeightAndTop - scrollTop;
		if( index == 0 ) {
			self.css( 'bottom', scrollTop );
		} else {
			self.css( 'top', selfOffsetTop );
		}
	} );	
}

function renderSubject( item ) {
	$( '.img_outer' ).remove();
	$( window ).unbind( 'scroll', descScroll );

	var html = "";
	var images = item.images;
	for( var i = 0; i < images.length; i++ ) {
		html += "<div class='img_outer' style='height:"+ $( window ).height() +"px'><div class='desc'></div><img class='img' src='"+ images[ i ] +"' /></div>";
	}
	$( 'body' ).css( 'overflow', 'auto' ).append( $( html ) );

	$( '.img_outer' ).eq( 0 ).css( {
		'position': 'relative',
		'top': 0,
		'opacity': 0
	} ).animate( { 'opacity': 1 }, 400, function() {
		$( '.img_outer' ).eq( 0 ).css( {
			position: 'static'
		});
	} );
	$( window ).bind( 'scroll', descScroll );
}

function viewSubject( items, e ) {
		var self = this;
		var groupA = [];
		var groupB = [];
		var index = items.index( $( this ) );
		
		$( '#items .item:lt('+ index +')' ).each( function() {
			groupA.push( $( this ) );
		});
		$( '#items .item:gt('+ index +')' ).each( function() {
			groupB.push( $( this ) );
		});
		if( $( window ).height() / 2 > e.pageY ) {
			groupA.push( $( this ) );
		} else {
			groupB.push( $( this ) );
		}

		var all = groupA.concat( groupB );
		for( var i = 0; i < all.length; i++ ) {
			all[ i ].top = all[ i ].offset().top;
		}

		$( '#items' ).scrollTop( 0 );
		for( var i = 0; i < all.length; i++ ) {
			all[ i ].css( { 'position': 'absolute', top: all[ i ].top } );
		}

		for( var i = 0; i < groupA.length; i++ ) {
			var item = groupA[ i ];
			var top = item.offset().top;
			if( top + item.height() <= 0 ) {
				continue;
			}
			var moveHeight = top + item.height();
			item.animate( { 'top': '-=' + moveHeight }, 500, function() {
				$( '#items' ).hide();
			} );
		}    

		for( var i = 0; i < groupB.length; i++ ) {
			var item = groupB[ i ];
			var top = item.offset().top;
			if( top > $( window ).height() ) {
				continue;
			}
			var moveHeight = $( window ).height() - top;
			item.animate( { 'top': '+=' + moveHeight }, 500 );
		}    		

		renderSubject( data[ items.index( $( this ) ) ]  );
}

function bindScrollItemsEvent() {
	var timer;
	$( '#items' ).bind( 'mouseover', function( e ) {
		window.clearInterval( timer );
		var pageY = e.pageY;
		var windowHeight = $( window ).height();
		var self = $( this );
		if( pageY < windowHeight / 2  ) {
			timer = window.setInterval( function() {
				var scrollTop = self.scrollTop();
				self.scrollTop( scrollTop + 4 );
			}, 30 );
		} else {
			timer = window.setInterval( function() {
				var scrollTop = self.scrollTop();
				self.scrollTop( scrollTop - 4 );
			}, 30 );
		}
	} );
	$( 'body' ).bind( 'mouseout', function() {
		window.clearInterval( timer );
	} );

	var items = $( '#items .item' );
	items.bind( 'click', function( e ) {
		window.clearInterval( timer );
		$( '#items' ).unbind( 'mouseover' );

		viewSubject.call( this, items, e );
	} );
}

$( function() {
	var resources = ['http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/14.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/15.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/16.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/17.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/18.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/19.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/20.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/21.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/22.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/23.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/24.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/25.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/26.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/27.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/28.jpg'
						,'http://chhblog.com/upload/1/files/myfiles/20131015/thumbs/29.jpg'];

	resources = resources.concat( ['http://chhblog.com/upload/1/files/myfiles/20131015/images/14.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/15.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/16.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/17.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/18.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/19.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/20.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/21.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/22.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/23.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/24.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/25.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/26.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/27.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/28.jpg'
									,'http://chhblog.com/upload/1/files/myfiles/20131015/images/29.jpg'] );
	for( var i = 0; i < resources.length; i++ ) {
		resources[ i ] = resources[ i ] + "?t=" + new Date().getTime().toString( '36' );
	}
	loadResource( resources, function() {
		init();
		$( '#loading' ).remove();
	} );
} );

</script>

</body>
</html>